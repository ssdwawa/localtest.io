<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script type="text/javascript">
      window._AMapSecurityConfig = {
        securityJsCode: "b4339ae190b3953ed364c6c1287814ac",
      };
    </script>
    <script
      type="text/javascript"
      src="https://webapi.amap.com/maps?v=2.0&key=44e384baa212dea24cfbd8a9375cb143"
    ></script>
    <script
      type="text/javascript"
      src="https://api.map.baidu.com/api?v=2.0&ak=kNDtRnW681B8hOVkrHGBMayOeGNZYl3V"
    ></script>
    <script type="text/javascript">
      function clickCheckbox() {
        AMap.plugin("AMap.Geolocation", function () {
          var geolocation = new AMap.Geolocation({
            // 是否使用高精度定位，默认：true
            enableHighAccuracy: true,
            // 设置定位超时时间，默认：无穷大
            timeout: 10000,
            // 定位按钮的停靠位置的偏移量，默认：Pixel(10, 20)
            buttonOffset: new AMap.Pixel(10, 20),
            //  定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
            zoomToAccuracy: true,
            //  定位按钮的排放位置,  RB表示右下
            buttonPosition: "RB",
          });

          geolocation.getCurrentPosition(function (status, result) {
            if (status == "complete") {
              onComplete(result);
            } else {
              onError(result);
            }
          });

          function onComplete(data) {
            // data是具体的定位信息
            console.log(data.position);
            AMap.plugin("AMap.Geocoder", function () {
              var geocoder = new AMap.Geocoder();

              var lnglat1 = [data.position.lng, data.position.lat];

              geocoder.getAddress(lnglat1, function (status, result) {
                console.log(status, result, lnglat, lnglat1);
                if (status === "complete" && result.info === "OK") {
                  alert(JSON.stringify(result));
                } else {
                  alert(status);
                }
              });
            });
            // window.open(
            //   `https://gis.10621234.com:9081/dugis-baidu/reverse_geocoding/v3/?output=json&coordtype=wgs84ll&location=${data.position.lat},${data.position.lng}&ApiAuthorization=baidu-22646676e3b949b39a39ad5d57ffd149`
            // );
          }

          function onError(data) {
            // 定位出错
            console.log(data);
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition(
                function (position) {
                  //获取地理位置成功时所做的处理
                  var crd = position.coords;

                  console.log("Your current position is:");
                  console.log(`Latitude : ${crd.latitude}`);
                  console.log(`Longitude: ${crd.longitude}`);
                  console.log(`More or less ${crd.accuracy} meters.`);
                },
                function (error) {
                  alert("xxxxx");
                }, //以下是可选属性
                {
                  enableHighAccuracy: true, //是否要求高精度的地理位置信息
                  timeout: 5000, //对地理位置信息的获取操作做超时限制，如果再该事件内未获取到地理位置信息，将返回错误
                  maximumAge: 60 * 1000, //设置缓存有效时间，在该时间段内，获取的地理位置信息还是设置此时间段之前的那次获得的信息，超过这段时间缓存的位置信息会被废弃
                }
              );
            } else {
              console.debug("不支持获取GPS地理位置");
            }
          }
        });
      }

      function baiduCheckbox() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              //获取地理位置成功时所做的处理
              var crd = position.coords;

              console.log("Your current position is:");
              console.log(`Latitude : ${crd.latitude}`);
              console.log(`Longitude: ${crd.longitude}`);
              console.log(`More or less ${crd.accuracy} meters.`);
            },
            function (error) {
              console.log(error)
              alert("xxxxx");
            }, //以下是可选属性
            {
              enableHighAccuracy: true, //是否要求高精度的地理位置信息
              timeout: 5000, //对地理位置信息的获取操作做超时限制，如果再该事件内未获取到地理位置信息，将返回错误
              maximumAge: 60 * 1000, //设置缓存有效时间，在该时间段内，获取的地理位置信息还是设置此时间段之前的那次获得的信息，超过这段时间缓存的位置信息会被废弃
            }
          );
        } else {
          console.debug("不支持获取GPS地理位置");
        }
      }
    </script>
  </head>
  <body>
    <button onclick="clickCheckbox()">高德获取定位</button>
    <button onclick="baiduCheckbox()">原生获取定位</button>
  </body>
</html>
